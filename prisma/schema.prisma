generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  MANAGER
  EMPLOYEE
  HR
}

enum EmploymentStatus {
  ACTIVE
  INACTIVE
  TERMINATED
  ON_LEAVE
}

enum RequestType {
  LEAVE
  REMOTE_WORK
  EXPENSE
  OTHER
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  passwordHash  String
  firstName     String
  lastName      String
  isActive      Boolean        @default(true)
  lastLoginAt   DateTime?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  roles         UserRole[]
  employee      Employee?
  refreshTokens RefreshToken[]
  // auditLogs          AuditLog[]
  // requestsToApprove  Request[]      @relation("RequestApprover")
  // timeEntriesCreated TimeEntry[]    @relation("TimeEntryCreatedBy")
}

model UserRole {
  id     String @id @default(uuid())
  userId String
  role   Role

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, role])
  @@index([role])
}

model Employee {
  id           String           @id @default(uuid())
  userId       String           @unique
  employeeCode String           @unique
  jobTitle     String?
  department   String?
  managerId    String?
  hireDate     DateTime?
  status       EmploymentStatus @default(ACTIVE)
  phone        String?
  location     String?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // timeEntries   TimeEntry[]
  // requests      Request[]
}

model RefreshToken {
  id              String    @id @default(uuid())
  userId          String
  token           String    @unique
  expiresAt       DateTime
  revokedAt       DateTime?
  replacedByToken String?
  userAgent       String?
  ipAddress       String?
  createdAt       DateTime  @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
}

// model TimeEntry {
//   id          String    @id @default(uuid())
//   employeeId  String
//   clockInAt   DateTime
//   clockOutAt  DateTime?
//   note        String?
//   createdAt   DateTime  @default(now())
//   updatedAt   DateTime  @updatedAt
//   createdById String?

//   employee  Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
//   createdBy User?    @relation("TimeEntryCreatedBy", fields: [createdById], references: [id], onDelete: SetNull)

//   @@index([employeeId, clockInAt])
// }

// model Request {
//   id          String        @id @default(uuid())
//   employeeId  String
//   approverId  String?
//   type        RequestType
//   status      RequestStatus @default(PENDING)
//   title       String
//   description String?
//   priority    Int           @default(3)
//   submittedAt DateTime      @default(now())
//   respondedAt DateTime?
//   createdAt   DateTime      @default(now())
//   updatedAt   DateTime      @updatedAt

//   employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
//   approver User?    @relation("RequestApprover", fields: [approverId], references: [id], onDelete: SetNull)

//   @@index([employeeId, status])
//   @@index([approverId])
//   @@index([type])
// }

// model AuditLog {
//   id        String   @id @default(uuid())
//   userId    String?
//   action    String
//   entity    String?
//   entityId  String?
//   metadata  Json?
//   createdAt DateTime @default(now())

//   user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

//   @@index([entity, entityId])
//   @@index([userId])
// }
